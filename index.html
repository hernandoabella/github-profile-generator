<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Github Profiles</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  <script
  src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js"
  integrity="sha512-DZqqY3PiOvTP9HkjIWgjO6ouCbq+dxqWoJZ/Q+zPYNHmlnI2dQnbJ5bxAHpAMw+LXRm4D72EIRXzvcHQtE8/VQ=="
  crossorigin="anonymous"
></script>
</head>
<body>
  <div class="container">
    <form class="user-form" id="form">
      <span class="icono-busqueda">
        <i class="fas fa-search"></i>
      </span>
      <input type="text" id="search" autocomplete="off" placeholder="Buscar un usuario de Github" />
    </form>
    
    <main id="main"></main>
  </div>

  
  
  <script>
    const APIURL = "https://api.github.com/users/";
    const main = document.getElementById("main");
    const form = document.getElementById("form");
    const search = document.getElementById("search");

    async function getUser(username) {
      try {
        const { data } = await axios(APIURL + username);
        createUserCard(data);
        getRepos(username);
      } catch (err) {
        if (err.response.status == 404) {
          createErrorCard("No profile with this username");
        }
      }
    }

    async function getRepos(username) {
      try {
        const { data } = await axios(APIURL + username + "/repos?sort=created");
        addReposToCard(data);
      } catch (err) {
        createErrorCard("Problem fetching repos");
      }
    }

    function createUserCard(user) {
      const userID = user.name || user.login;
      const userBio = user.bio ? `<p>${user.bio}</p>` : "";
      const cardHTML = `
        <div class="card">
          <div>
            <img src="${user.avatar_url}" alt="${user.name}" class="avatar">
          </div>
          <div class="user-info">
            <h2>${userID}</h2>
            ${userBio}
            <ul>
              <li>${user.followers} <strong>Seguidores</strong></li>
              <li>${user.following} <strong>Siguiendo</strong></li>
              <li>${user.public_repos} <strong>Repos</strong></li>
            </ul>
            <div id="repos"></div>
            <span class="close-btn" onclick="closeCard()"><i class="fas fa-times"></i>
</span>
          </div>
        </div>
      `;
      main.innerHTML = cardHTML;
      search.style.display = "none";
    }

    function createErrorCard(msg) {
      const cardHTML = `
        <div class="card">
          <h1>${msg}</h1>
        </div>
      `;
      main.innerHTML = cardHTML;
      search.style.display = "none";
    }

    function addReposToCard(repos) {
      const reposEl = document.getElementById("repos");
      repos.slice(0, 5).forEach((repo) => {
        const repoEl = document.createElement("a");
        repoEl.classList.add("repo");
        repoEl.href = repo.html_url;
        repoEl.target = "_blank";
        repoEl.innerText = repo.name;
        reposEl.appendChild(repoEl);
      });
    }

    function closeCard() {
      main.innerHTML = "";
      search.style.display = "block";
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const user = search.value;
      if (user) {
        getUser(user);
        search.value = "";
      }
    });
  </script>
</body>
</html>
